{"title":"快速失败和安全失败","date":"2020-07-13T08:00:47.000Z","date_formatted":{"ll":"2020年7月13日","L":"2020/07/13","MM-DD":"07-13"},"link":"2020/07/13/快速失败和安全失败","tags":["Java集合"],"updated":"2020-07-13T08:27:00.173Z","content":"<h1 id=\"快速失败和安全失败\">快速失败和安全失败<a href=\"#快速失败和安全失败\" title=\"快速失败和安全失败\"></a></h1><h2 id=\"快速失败（fail-fast）\">快速失败（fail-fast）<a href=\"#快速失败（fail-fast）\" title=\"快速失败（fail-fast）\"></a></h2><p>在用迭代器遍历一个集合对象时，如果遍历过程中对集合对象的内容进行了修改（增加、删除、修改），则会抛出<code>Concurrent Modification Exception</code>。</p>\n<h3 id=\"原理\">原理<a href=\"#原理\" title=\"原理\"></a></h3><p>迭代器在遍历时直接访问集合中的内容，并且在遍历过程中使用一个<code>modCount</code>变量。集合在被遍历期间如果内容发生变化，就会改变<code>modCount</code>的值。迭代器使用<code>hashNext()/next()</code>遍历下一个元素之前，都会检测<code>modCount</code>变量是否为<code>expectedModCount</code>，是的话返回遍历，否则抛出异常，终止遍历。</p>\n<h3 id=\"场景\">场景<a href=\"#场景\" title=\"场景\"></a></h3><p><code>java.util</code>包下的集合类都是快速失败的，不能在多线程下发生并发修改，或者在迭代过程中修改。</p>\n<h2 id=\"安全失败（fail-safe）\">安全失败（fail-safe）<a href=\"#安全失败（fail-safe）\" title=\"安全失败（fail-safe）\"></a></h2><p>遍历时不是直接在集合内容上访问的，而是先复制原有集合内容，在拷贝的集合上进行遍历。</p>\n<h3 id=\"原理-1\">原理<a href=\"#原理-1\" title=\"原理\"></a></h3><p>由于迭代时是对原集合的拷贝进行遍历，在遍历过程中对原集合所作的修改并不能被迭代器检测到，故不会抛 <code>ConcurrentModificationException</code> 异常。</p>\n<h3 id=\"场景-1\">场景<a href=\"#场景-1\" title=\"场景\"></a></h3><p><code>java.util.concurrent</code>包下的容器都是安全失败的，可以在多线程下并发使用，并发修改。</p>\n","prev":{"title":"关于并发","link":"2020/07/13/关于并发"},"next":{"title":"类加载器","link":"2020/07/13/类加载器"},"plink":"https://cxccao.github.io/2020/07/13/快速失败和安全失败/","toc":[{"id":"快速失败和安全失败","title":"快速失败和安全失败","index":"1","children":[{"id":"快速失败（fail-fast）","title":"快速失败（fail-fast）","index":"1.1","children":[{"id":"原理","title":"原理","index":"1.1.1"},{"id":"场景","title":"场景","index":"1.1.2"}]},{"id":"安全失败（fail-safe）","title":"安全失败（fail-safe）","index":"1.2","children":[{"id":"原理-1","title":"原理","index":"1.2.1"},{"id":"场景-1","title":"场景","index":"1.2.2"}]}]}],"copyright":{"author":"Shelton Chen","link":"<a href=\"https://cxccao.github.io/2020/07/13/快速失败和安全失败/\" title=\"快速失败和安全失败\">https://cxccao.github.io/2020/07/13/快速失败和安全失败/</a>","updated":"2020年7月13日","license":"署名-非商业性使用-相同方式共享 4.0 国际 (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)"}}